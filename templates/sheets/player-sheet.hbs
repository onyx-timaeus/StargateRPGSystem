<form class="{{cssClass}} sgrpg charsheet" autocomplete="off">

<div class="sheet-header">
  <nav class="sheet-navigation tabs" data-group="primary">
    <a class="item active" data-tab="character">Character</a>
    <a class="item" data-tab="background">Background</a>
    <a class="item" data-tab="configuration">Configuration</a>
  </nav>
</div>

<div class="sg-sheet-body">

<!-- CHARACTER TAB -->
<main class="character tab-content page1 tab" data-tab="character">

  <!-- NAME SECTION -->
  <section class="name columnflex nowrap">
    <!-- Profile Picture - First box -->
    <div class="section profile-img-box">
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
    </div>

    <!-- Character Info - Second box -->
    <div class="section name-content">
      <div class="rowflex nowrap spaced">
        <div class="columnflex nowrap">
          <label title="Level">Level</label>
          <input class="w40" name="system.rank" type="number" placeholder="1" value="{{system.rank}}">
        </div>
        <div class="columnflex nowrap">
          <label>Name</label>
          <input name="name" type="text" value="{{actor.name}}">
        </div>
        <div class="columnflex nowrap">
          <label>Race</label>
          <input name="system.race" list="race" placeholder="race" type="text" value="{{system.race}}">
        </div>
        <div class="columnflex nowrap">
          <label>Class</label>
          <input name="system.class" list="rpgclass" placeholder="class" type="text" value="{{system.class}}">
        </div>
      </div>

      <!-- ROW 2: DETERMINATION / TENSION DIE / HIT DICE / EUREKA -->
      <div class="rowflex nowrap spaced row2">
        <div class="columnflex nowrap">
          <label>Determination</label>
          <div class="rowflex nowrap">
            <input class="stat w40" name="system.determination.value" type="number" value="{{system.determination.value}}" title="Determination">
            <span class="slash">/</span>
            <input class="stat w40" name="system.determination.max" type="number" value="{{system.determination.max}}" title="Max Determination">
          </div>
        </div>
        <div class="columnflex nowrap center">
          <label title="Tension Die">Tension Die</label>
          <button type="button" class="td-roll-btn" data-action="rollTD" title="Roll Tension Die">{{system.tensionDie}}</button>
        </div>
        <div class="columnflex nowrap center">
          <label title="Hit Dice">Hit Dice</label>
          <button type="button" class="hd-roll-btn" data-action="rollHD" title="Roll Hit Dice">{{system.hd}}</button>
        </div>
        {{#if system.showEurekaPoints}}
        <div class="columnflex nowrap eureka">
          <label>Eureka Points</label>
          <div class="rowflex nowrap">
            <input class="w40" name="system.eureka" type="number" placeholder="0" title="Eureka Points" value="{{system.eureka}}">
            <span>/</span>
            <input class="w40" name="system.eureka_max" type="number" placeholder="" title="Max Eureka Points" value="{{system.eureka_max}}">
          </div>
        </div>
        {{/if}}
      </div>
    </div>

    <!-- DEATH SAVE BOX - Third box -->
    <div class="deathsave-box">
      <div class="section death columnflex nowrap center">
        <a type="roll_deathsave" class="txt-btn large" data-action="rollDeathSave">Death Save</a>
        <div class="death-save-checks">
          <div class="rowflex nowrap gap5 aligned">
            <input name="system.death_success1" type="checkbox" {{checked system.death_success1}}>
            <input name="system.death_success2" type="checkbox" {{checked system.death_success2}}>
            <input name="system.death_success3" type="checkbox" {{checked system.death_success3}}>
            <span>Successes</span>
          </div>
          <div class="rowflex nowrap gap5 aligned">
            <input name="system.death_failure1" type="checkbox" {{checked system.death_failure1}}>
            <input name="system.death_failure2" type="checkbox" {{checked system.death_failure2}}>
            <input name="system.death_failure3" type="checkbox" {{checked system.death_failure3}}>
            <span>Failures</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ABILITY SCORES (HORIZONTAL BADGES) -->
  <div class="attr rowflex nowrap center">
    {{#each system.attributes as |attr a|}}
      <div class="stat columnflex nowrap center middle" data-attr="{{a}}">
        <a type="roll" class="txt-btn large" data-bonus="system.attributes.{{a}}.mod">{{a}}</a>
        <input data_type="ability_value" name="system.attributes.{{a}}.value" type="number" value="{{attr.value}}">
        <span class="mod">{{attr.mod}}</span>
      </div>
    {{/each}}
  </div>

  <!-- MAIN CONTENT AREA (SKILLS + RIGHT SIDE) -->
  <div class="main-content-area">

    <!-- SKILLS SECTION (LEFT) -->
    <section class="skills columnflex nowrap spaced">
      <h3>Skills</h3>
      {{#each system.skills as |skill s|}}
        <div class="rowflex nowrap" data-skill="{{s}}">
          <input data_type="skill_prof" name="system.skills.{{s}}.proficient" type="checkbox" {{checked skill.proficient}} title="Proficiency">
          <input class="w30" data_type="skill_value" name="system.skills.{{s}}.value" type="text" value="{{skill.value}}">
          <a type="roll" class="txt-btn" data-bonus="system.skills.{{s}}.value">{{lookup @root.config.skills s}}</a>
          <span class="skill-ability-label">({{skill.mod}})</span>
        </div>
      {{/each}}
    </section>

    <!-- RIGHT SIDE (STATS + SAVES + CONDITION + INVENTORY) -->
    <div class="right-side">

      <!-- STATS CONTAINER -->
      <div class="stats-container">
        <div class="stat-box hp-box">
          <label title="Hit Points">HP</label>
          <div class="stat-row">
            <input class="stat w40" name="system.health.value" type="number" value="{{system.health.value}}" placeholder="20">
            <span class="slash">/</span>
            <input class="stat w40" name="system.health.max" type="number" value="{{system.health.max}}" placeholder="20">
          </div>
        </div>

        <div class="stat-box temp-hp-box">
          <label title="Temporary Hit Points">Temp HP</label>
          <div class="stat-row">
            <input class="stat w40" name="system.temp_health.value" type="number" value="{{system.temp_health.value}}">
            <span class="slash">/</span>
            <input class="stat w40" name="system.temp_health.max" type="number" value="{{system.temp_health.max}}">
          </div>
        </div>

        <div class="stat-box ac-box">
          <label>Armor Class</label>
          <input class="stat w70" name="system.ac" type="number" value="{{system.ac}}">
        </div>

        <div class="stat-box speed-box">
          <label>Speed</label>
          <input class="w70 stat" name="system.speed" type="text" value="{{system.speed}}">
        </div>

        <div class="stat-box">
          <a type="roll_init" class="txt-btn">Initiative</a>
          <input class="stat w40" name="system.initiative" type="number" value="{{system.initiative}}">
        </div>

        <div class="stat-box">
          <a type="roll_moxie" class="txt-btn">Moxie</a>
          <input class="stat w40" name="system.moxie" type="number" value="{{system.moxie}}">
        </div>

        <div class="stat-box">
          <label title="Bulk">Bulk</label>
          <input class="stat w40" name="system.bulk" type="number" value="{{system.bulk}}">
        </div>

        <div class="stat-box">
          <label title="Proficiency Bonus">Prof Bonus</label>
          <input class="stat w40" name="system.prof" type="number" value="{{system.prof}}">
        </div>
      </div>

      <!-- SAVES, CONDITION, AND INVENTORY CONTAINER -->
      <div class="saves-inventory-container">
        <div class="saves-condition-column">

          <!-- SAVES SECTION -->
          <section class="saves columnflex nowrap">
            <h3>Saves</h3>
            {{#each system.saves as |save s|}}
              <div class="rowflex nowrap" data-save="{{s}}">
                <input data_type="skill_prof" name="system.saves.{{s}}.proficient" type="checkbox" {{checked save.proficient}}>
                <input class="w30" name="system.saves.{{s}}.value" type="text" value="{{save.value}}">
                <a type="roll" class="txt-btn" data-bonus="system.saves.{{s}}.value">{{lookup ../config.saves s}}</a>
              </div>
            {{/each}}
          </section>

          <!-- CONDITION SECTION -->
          <section class="condition columnflex nowrap spaced">
            <h3 class="txtcenter">CONDITION</h3>
            {{radioBoxes "system.condition" config.conditions checked=system.condition localize=false}}
          </section>

        </div>

        <!-- INVENTORY SECTION -->
        <section class="inventory columnflex nowrap center">
          <h4>Inventory</h4>
          <div class="inventory-content">
            {{> "systems/sgrpg/templates/sheets/parts/actor-equip-inventory.hbs"}}
          </div>
        </section>

      </div>
    </div>
  </div>

  <!-- WEAPONS SECTION -->
  <section class="weapons columnflex nowrap center">
    <h4>Weapons</h4>
    {{> "systems/sgrpg/templates/sheets/parts/actor-weapon-inventory.hbs"}}
  </section>

</main>

<!-- BACKGROUND TAB (UNCHANGED FOR NOW) -->
<main class="background tab-content page2 tab" data-tab="background">
  <section class="racial_abilities columnflex nowrap center">
    <label>Racial Abilities</label>
    {{editor system.abilities.racial target="system.abilities.racial" button=true owner=owner editable=editable}}
  </section>

  <section class="feats columnflex nowrap center">
    <label>Feats</label>
    {{editor system.abilities.feats target="system.abilities.feats" button=true owner=owner editable=editable}}
  </section>

  <section class="class columnflex nowrap center">
    <label>Class Abilities</label>
    {{editor system.abilities.class target="system.abilities.class" button=true owner=owner editable=editable}}
  </section>

  <section class="equipment columnflex nowrap center">
    <label>Equipment notes</label>
    {{editor system.abilities.equipment target="system.abilities.equipment" button=true owner=owner editable=editable}}
  </section>

  <section class="prof columnflex nowrap center">
    <label>Proficiencies</label>
    {{editor system.abilities.proficiencies target="system.abilities.proficiencies" button=true owner=owner editable=editable}}
  </section>
</main>

<!-- CONFIGURATION TAB -->
<main class="configuration tab-content page3 tab" data-tab="configuration">

  <!-- ADVANCED CONFIGURATION -->
  <section class="advanced-config columnflex nowrap center">
    <h3>Advanced Configuration</h3>
    <a class="config-button" title="Configure sheet flags" data-action="flags">
      <i class="fa fa-cog"></i> Sheet Flags Configuration
    </a>
  </section>

  <!-- DICE CONFIGURATION -->
  <section class="dice-config columnflex nowrap">
    <h3>Dice Configuration</h3>
    <div class="config-row">
      <div class="config-item">
        <label>Tension Die</label>
        <select name="system.tensionDie">
          <option value="d4" {{#if (eq system.tensionDie "d4")}}selected{{/if}}>d4</option>
          <option value="d6" {{#if (eq system.tensionDie "d6")}}selected{{/if}}>d6</option>
          <option value="d8" {{#if (eq system.tensionDie "d8")}}selected{{/if}}>d8</option>
          <option value="d10" {{#if (eq system.tensionDie "d10")}}selected{{/if}}>d10</option>
          <option value="d12" {{#if (eq system.tensionDie "d12")}}selected{{/if}}>d12</option>
        </select>
      </div>
      <div class="config-item">
        <label>Hit Dice</label>
        <select name="system.hd">
          <option value="d4" {{#if (eq system.hd "d4")}}selected{{/if}}>d4</option>
          <option value="d6" {{#if (eq system.hd "d6")}}selected{{/if}}>d6</option>
          <option value="d8" {{#if (eq system.hd "d8")}}selected{{/if}}>d8</option>
          <option value="d10" {{#if (eq system.hd "d10")}}selected{{/if}}>d10</option>
          <option value="d12" {{#if (eq system.hd "d12")}}selected{{/if}}>d12</option>
        </select>
      </div>
    </div>
  </section>

  <!-- DISPLAY OPTIONS -->
  <section class="display-config columnflex nowrap">
    <h3>Display Options</h3>
    <div class="config-row">
      <div class="config-item checkbox-config">
        <label>
          <input type="checkbox" name="system.showEurekaPoints" {{checked system.showEurekaPoints}}>
          Show Eureka Points
        </label>
      </div>
    </div>
  </section>

  <!-- SKILL ATTRIBUTE CONFIGURATION -->
  <section class="skill-config columnflex nowrap">
    <h3>Skill Attribute Configuration</h3>
    <p>Configure which attribute modifier each skill uses. Defaults are set automatically, but you can override them here.</p>

    <div class="skill-config-grid">
      {{#each system.skills as |skill s|}}
        <div class="skill-config-row rowflex nowrap" data-skill="{{s}}">
          <label class="skill-name">{{s}}</label>
          <select data_type="skill_mod" name="system.skills.{{s}}.mod" class="skillModSelect">
            {{selectOptions ../config.abilities selected=skill.mod localize=false}}
          </select>
          <a class="skill-mod-revert" title="Revert to default attribute mod"><i class="fa fa-undo"></i></a>
        </div>
      {{/each}}
    </div>
  </section>
</main>

</div>
</form>
